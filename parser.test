<?php

class ParserTestCase extends DrupalWebTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Parser module functionality',
      'description' => 'Tests Parser module',
      'group' => 'Parser',
    );
  }
  
  public function testAbsoluteUrl() {
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '/'),                        'http://example.com/');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '?a=b'),                     'http://example.com/?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          './index.php'),              'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '../index.php'),             'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          'bar/index.php'),            'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '/bar/index.php'),           'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '/bar/index.php?a=b'),       'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          '//test.ru/index.php'),      'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com',          'http://test.ru/index.php'), 'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '/'),                        'http://example.com/');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '?a=b'),                     'http://example.com/?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         './index.php'),              'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '../index.php'),             'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         'bar/index.php'),            'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '/bar/index.php'),           'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '/bar/index.php?a=b'),       'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         '//test.ru/index.php'),      'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/',         'http://test.ru/index.php'), 'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '?a=b'),                     'http://example.com/foo?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      './index.php'),              'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '../index.php'),             'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '../../index.php'),          'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      'bar/index.php'),            'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '/bar/index.php'),           'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '/bar/index.php?a=b'),       'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      '//test.ru/index.php'),      'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo',      'http://test.ru/index.php'), 'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '?a=b'),                     'http://example.com/foo/?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     'index.php'),                'http://example.com/foo/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     './index.php'),              'http://example.com/foo/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '../index.php'),             'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '../../index.php'),          'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     'bar/index.php'),            'http://example.com/foo/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '/bar/index.php'),           'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '/bar/index.php?a=b'),       'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     '//test.ru/index.php'),      'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/',     'http://test.ru/index.php'), 'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', '/'),                        'http://example.com/');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', '?a=b'),                     'http://example.com/foo/bar/?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', 'index.php'),                'http://example.com/foo/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', './index.php'),              'http://example.com/foo/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', '../index.php'),             'http://example.com/foo/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo/bar/', '../../index.php'),          'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '?c=d'),                      'http://example.com/foo?c=d');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', 'index.php'),                 'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '/index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', './index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '../index.php'),              'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '../../index.php'),           'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', 'bar/index.php'),             'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '/bar/index.php'),            'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '/bar/index.php?a=b'),        'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', '//test.ru/index.php'),       'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b', 'http://test.ru/index.php'),  'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '?c=d'),                     'http://example.com/foo?c=d');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', 'index.php'),                'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '/index.php'),               'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', './index.php'),              'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '../index.php'),             'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '../../index.php'),          'http://example.com/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', 'bar/index.php'),            'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '/bar/index.php'),           'http://example.com/bar/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '/bar/index.php?a=b'),       'http://example.com/bar/index.php?a=b');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', '//test.ru/index.php'),      'http://test.ru/index.php');
    $this->assertEqual(parser_get_absolute_url('http://example.com/foo?a=b/', 'http://test.ru/index.php'), 'http://test.ru/index.php');
  }
}
